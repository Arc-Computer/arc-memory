# PR Comment Formatter Implementation Plan

## Overview

The PR Comment Formatter will take the structured insights generated by the PR Context Processor and format them as Markdown for GitHub comments. The formatter will follow the design shown in the mockup, with three numbered sections and a clean layout.

## Class Structure

```typescript
export class CommentFormatter {
  /**
   * Format the insights as Markdown for a GitHub comment
   */
  formatComment(insights: PRInsights): string {
    // Format the header
    // Format the three sections
    // Return the formatted comment
  }

  /**
   * Format the design decisions section
   */
  private formatDesignDecisions(designDecisions: DesignDecisionsInsight): string {
    // Format the design decisions section
  }

  /**
   * Format the impact analysis section
   */
  private formatImpactAnalysis(impactAnalysis: ImpactAnalysisInsight): string {
    // Format the impact analysis section
  }

  /**
   * Format the test verification section
   */
  private formatTestVerification(testVerification: TestVerificationInsight): string {
    // Format the test verification section
  }

  /**
   * Format the code diff
   */
  private formatCodeDiff(diff: string): string {
    // Format the code diff
  }


}
```

## Markdown Templates

### Header Template

```markdown
When reviewing this {pr.title}, Arc shows you:

1️⃣ The original design decisions behind the code
2️⃣ The predicted impact of the change
3️⃣ Proof that the change was properly tested
```

### Design Decisions Template

```markdown
### 1️⃣ The original design decisions behind the code

{designDecisions.summary}

{designDecisions.details}
```

### Impact Analysis Template

```markdown
### 2️⃣ The predicted impact of the change

{impactAnalysis.summary}

**Risk Score:** {impactAnalysis.riskScore.score}/100 ({impactAnalysis.riskScore.level})
{impactAnalysis.riskScore.explanation}

**Affected Components:**
{impactAnalysis.affectedComponents.map(component => `- ${component.name}: ${component.impact}`).join('\n')}
```

### Test Verification Template

```markdown
### 3️⃣ Proof that the change was properly tested

{testVerification.summary}

**Test Coverage:** {testVerification.coverage.percentage}%
{testVerification.coverage.assessment}

**Recommendations:**
{testVerification.recommendations.map(recommendation => `- ${recommendation}`).join('\n')}
```

### Code Diff Template

```markdown
<details>
<summary>View Code Changes</summary>

```diff
{diff}
```

</details>
```



## Implementation Steps

1. Create the CommentFormatter class with the basic structure
2. Implement the formatComment method
3. Implement the formatDesignDecisions method
4. Implement the formatImpactAnalysis method
5. Implement the formatTestVerification method
6. Implement the formatCodeDiff method

7. Add tests for the CommentFormatter class
8. Integrate the CommentFormatter with the PR Bot
